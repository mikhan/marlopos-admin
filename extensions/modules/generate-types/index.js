import{useApi as t,useStores as e,defineModule as n}from"@directus/extensions-sdk";import{resolveComponent as o,openBlock as a,createBlock as i,withCtx as l,createElementBlock as d,Fragment as r,renderList as c,createVNode as s,createElementVNode as p,computed as u,defineComponent as v,resolveDirective as f,withDirectives as y,createCommentVNode as g}from"vue";import{useI18n as m}from"vue-i18n";const b={ts:{name:"TypeScript",icon:'<svg style="width: 100%; height: 100%" viewBox="0 0 128 128" fill="currentColor"><path d="M2 63.91v62.5h125v-125H2zm100.73-5a15.56 15.56 0 017.82 4.5 20.58 20.58 0 013 4c0 .16-5.4 3.81-8.69 5.85-.12.08-.6-.44-1.13-1.23a7.09 7.09 0 00-5.87-3.53c-3.79-.26-6.23 1.73-6.21 5a4.58 4.58 0 00.54 2.34c.83 1.73 2.38 2.76 7.24 4.86 8.95 3.85 12.78 6.39 15.16 10 2.66 4 3.25 10.46 1.45 15.24-2 5.2-6.9 8.73-13.83 9.9a38.32 38.32 0 01-9.52-.1A23 23 0 0180 109.19c-1.15-1.27-3.39-4.58-3.25-4.82a9.34 9.34 0 011.15-.73l4.6-2.64 3.59-2.08.75 1.11a16.78 16.78 0 004.74 4.54c4 2.1 9.46 1.81 12.16-.62a5.43 5.43 0 00.69-6.92c-1-1.39-3-2.56-8.59-5-6.45-2.78-9.23-4.5-11.77-7.24a16.48 16.48 0 01-3.43-6.25 25 25 0 01-.22-8c1.33-6.23 6-10.58 12.82-11.87a31.66 31.66 0 019.49.26zm-29.34 5.24v5.12H57.16v46.23H45.65V69.26H29.38v-5a49.19 49.19 0 01.14-5.16c.06-.08 10-.12 22-.1h21.81z"></path></svg>',logo:'<svg style="width: 100%; height: 100%" viewBox="0 0 128 128"><path fill="#007acc" d="M2 63.91v62.5h125v-125H2zm100.73-5a15.56 15.56 0 017.82 4.5 20.58 20.58 0 013 4c0 .16-5.4 3.81-8.69 5.85-.12.08-.6-.44-1.13-1.23a7.09 7.09 0 00-5.87-3.53c-3.79-.26-6.23 1.73-6.21 5a4.58 4.58 0 00.54 2.34c.83 1.73 2.38 2.76 7.24 4.86 8.95 3.85 12.78 6.39 15.16 10 2.66 4 3.25 10.46 1.45 15.24-2 5.2-6.9 8.73-13.83 9.9a38.32 38.32 0 01-9.52-.1A23 23 0 0180 109.19c-1.15-1.27-3.39-4.58-3.25-4.82a9.34 9.34 0 011.15-.73l4.6-2.64 3.59-2.08.75 1.11a16.78 16.78 0 004.74 4.54c4 2.1 9.46 1.81 12.16-.62a5.43 5.43 0 00.69-6.92c-1-1.39-3-2.56-8.59-5-6.45-2.78-9.23-4.5-11.77-7.24a16.48 16.48 0 01-3.43-6.25 25 25 0 01-.22-8c1.33-6.23 6-10.58 12.82-11.87a31.66 31.66 0 019.49.26zm-29.34 5.24v5.12H57.16v46.23H45.65V69.26H29.38v-5a49.19 49.19 0 01.14-5.16c.06-.08 10-.12 22-.1h21.81z"></path></svg>'}};var h={data:()=>({languages:b,version:"1.0.0"})};const w=["innerHTML"];var _=[],T=[];function x(t,e){if(t&&"undefined"!=typeof document){var n,o=!0===e.prepend?"prepend":"append",a=!0===e.singleTag,i="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(a){var l=_.indexOf(i);-1===l&&(l=_.push(i)-1,T[l]={}),n=T[l]&&T[l][o]?T[l][o]:T[l][o]=d()}else n=d();65279===t.charCodeAt(0)&&(t=t.substring(1)),n.styleSheet?n.styleSheet.cssText+=t:n.appendChild(document.createTextNode(t))}function d(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var n=Object.keys(e.attributes),a=0;a<n.length;a++)t.setAttribute(n[a],e.attributes[n[a]]);var l="prepend"===o?"afterbegin":"beforeend";return i.insertAdjacentElement(l,t),t}}async function C(e=!1){const n=await async function(){var e,n;const o=t(),a=(await o.get("/collections?limit=-1")).data.data,i={};for(const t of a.sort(((t,e)=>t.collection.localeCompare(e.collection))))i[t.collection]={...t,fields:[]};const l=(await o.get("/fields?limit=-1")).data.data;for(const t of l.sort(((t,e)=>t.field.localeCompare(e.field))))i[t.collection]?i[t.collection].fields.push(t):(d=`${t.collection} not found`,console.warn(`%c[directus-extension-generate-types]%c\n${d}`,"font-weight: bold;"));var d;for(const t of Object.keys(i))0===i[t].fields.length&&delete i[t];const r=(await o.get("/relations?limit=-1")).data.data;for(const t of r){const o=null==(e=i[t.meta.one_collection])?void 0:e.fields.find((e=>e.field===t.meta.one_field)),a=null==(n=i[t.meta.many_collection])?void 0:n.fields.find((e=>e.field===t.meta.many_field));o&&(o.relation={type:"many",collection:t.meta.many_collection}),a&&(a.relation={type:"one",collection:t.meta.one_collection})}return i}();let o="";const a=[];return Object.values(n).forEach((t=>{const n=t.collection,i=$(n);a.push(`${n}: ${i}`),o+=`export type ${i} = {\n`,t.fields.forEach((t=>{var n,a,i;(null==(a=null==(n=t.meta)?void 0:n.interface)?void 0:a.startsWith("presentation-"))||(o+=`  ${t.field.includes("-")?`"${t.field}"`:t.field}${(null==(i=t.schema)?void 0:i.is_nullable)?"?":""}: ${function(t,e=!1){var n;let o=function(t){return["integer","bigInteger","float","decimal"].includes(t)?"number":["boolean"].includes(t)?"boolean":["json","csv"].includes(t)?"unknown":"string"}(t.type);t.relation&&(o+=` ${e?"&":"|"} ${t.relation.collection?$(t.relation.collection):"any"}${"many"===t.relation.type?"[]":""}`);if(!(null==(n=t.schema)?void 0:n.is_nullable))return o;return t.relation&&e?`(${o}) | null`:o+" | null"}(t,e)};\n`)})),o+="};\n\n"})),o+="export type CustomDirectusTypes = {\n"+a.map((t=>`  ${t};`)).join("\n")+"\n};",o+="\n",o}function $(t){return t.split(" ").flatMap((t=>t.split("_"))).flatMap((t=>t.split("-"))).map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join("")}x("\n.icon[data-v-09d1a3b8] {\n  display: grid;\n  width: var(--v-icon-size);\n  height: var(--v-icon-size);\n  color: var(--v-icon-color);\n  place-content: center;\n}\n\n",{}),h.render=function(t,e,n,u,v,f){const y=o("v-list-item-icon"),g=o("v-text-overflow"),m=o("v-list-item-content"),b=o("v-list-item"),h=o("v-list");return a(),i(h,{nav:""},{default:l((()=>[(a(!0),d(r,null,c(Object.keys(t.languages),(e=>(a(),i(b,{key:e,to:`/generate-types/${e}`},{default:l((()=>[s(y,null,{default:l((()=>[p("div",{class:"icon",innerHTML:t.languages[e].icon},null,8,w)])),_:2},1024),s(m,null,{default:l((()=>[s(g,{text:t.languages[e].name},null,8,["text"])])),_:2},1024)])),_:2},1032,["to"])))),128))])),_:1})},h.__scopeId="data-v-09d1a3b8",h.__file="src/components/navigation.vue";var H=v({components:{NavbarComponent:h},data:()=>({types:"",languages:b,loading:!1,downloadName:"typings.d.ts"}),methods:{async generateTypes(){this.types=await C(),this.loading=!1},async copyValue(){await this.copyToClipboard(this.types,this.notificationStore)},downloadTypes(){!function(t,e,n="text/plain"){var o=new Blob([t],{type:n}),a=document.createElement("a");a.download=e,a.innerHTML="Download File",null!=window.webkitURL?a.href=window.webkitURL.createObjectURL(o):(a.href=window.URL.createObjectURL(o),a.style.display="none",document.body.appendChild(a)),a.click()}(this.types,this.downloadName,"application/json")}},mounted(){this.generateTypes()},setup(){const{useNotificationsStore:t}=e(),n=t(),{t:o}=m(),{isCopySupported:a,copyToClipboard:i}=function(){const{t:t}=m();return{isCopySupported:u((()=>{var t;return!!(null==(t=null==navigator?void 0:navigator.clipboard)?void 0:t.writeText)})),isPasteSupported:u((()=>{var t;return!!(null==(t=null==navigator?void 0:navigator.clipboard)?void 0:t.readText)})),copyToClipboard:async function(e,n,o){var a,i,l;try{return await(null==(a=null==navigator?void 0:navigator.clipboard)?void 0:a.writeText(e)),n.add({title:null!=(i=null==o?void 0:o.success)?i:t("copy_raw_value_success")}),!0}catch(e){return n.add({type:"error",title:null!=(l=null==o?void 0:o.fail)?l:t("copy_raw_value_fail")}),!1}},pasteFromClipboard:async function(e,n){var o,a,i;try{const i=await(null==(o=null==navigator?void 0:navigator.clipboard)?void 0:o.readText());return e.add({title:null!=(a=null==n?void 0:n.success)?a:t("paste_raw_value_success")}),i}catch(o){return e.add({type:"error",title:null!=(i=null==n?void 0:n.fail)?i:t("paste_raw_value_fail")}),null}}}}();return{isCopySupported:a,copyToClipboard:i,notificationStore:n,fields:[{field:"content",name:"typings.ts",type:"text",meta:{interface:"input-code",readonly:!0,width:"full",options:{language:"javascript",altOptions:{gutters:!1}}}}],t:o}}});const S=["innerHTML"];x("\n.logo-icon[data-v-3bdb8ddb] {\n  display: grid;\n  width: var(--v-button-height);\n  height: var(--v-button-height);\n  place-content: center;\n}\n.v-form[data-v-3bdb8ddb] {\n  padding: calc(var(--content-padding) * 3) var(--content-padding) var(--content-padding);\n  padding-bottom: var(--content-padding-bottom);\n@media (min-width: 600px) {\n    padding: var(--content-padding);\n    padding-bottom: var(--content-padding-bottom);\n}\n}\n",{}),H.render=function(t,e,n,d,r,c){const u=o("NavbarComponent"),v=o("v-icon"),m=o("v-button"),b=o("v-form"),h=o("private-view"),w=f("tooltip");return a(),i(h,{title:"Types for TypeScript"},{navigation:l((()=>[s(u)])),"title-outer:prepend":l((()=>[p("div",{class:"logo-icon",innerHTML:t.languages.ts.logo},null,8,S)])),actions:l((()=>[t.isCopySupported?y((a(),i(m,{key:0,rounded:"",icon:"",secondary:"",disabled:!t.types,onClick:e[0]||(e[0]=()=>t.copyValue())},{default:l((()=>[s(v,{name:"content_copy"})])),_:1},8,["disabled"])),[[w,t.t("copy"),void 0,{bottom:!0}]]):g("v-if",!0),y((a(),i(m,{rounded:"",icon:"",disabled:!t.types,onClick:e[1]||(e[1]=()=>t.downloadTypes())},{default:l((()=>[s(v,{name:"download"})])),_:1},8,["disabled"])),[[w,t.t("download"),void 0,{bottom:!0}]])])),default:l((()=>[s(b,{"model-value":{content:t.types},loading:!t.types,fields:t.fields},null,8,["model-value","loading","fields"])])),_:1})},H.__scopeId="data-v-3bdb8ddb",H.__file="src/routes/ts.vue";var j=n({id:"generate-types",name:"Generate Types",icon:"code",routes:[{path:"",redirect:"/generate-types/ts"},{path:"/generate-types/ts",component:H}],hidden:!1});export{j as default};
